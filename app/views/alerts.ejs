<% layout('layout') -%>

<h1>Alerts</h1>

<table>
  <thead>
    <tr>
      <th><a href="?<%= new URLSearchParams({ ...query, sortBy: 'timestamp', order: query.order === 'ASC' ? 'DESC' : 'ASC' }).toString() %>">Timestamp</a></th>
      <th><a href="?<%= new URLSearchParams({ ...query, sortBy: 'severity', order: query.order === 'ASC' ? 'DESC' : 'ASC' }).toString() %>">Severity</a></th>
      <th>Source IP</th>
      <th>Destination IP</th>
      <th>Protocol</th>
      <th>Message</th>
      <th>Status</th>
      <th>Action</th>
    </tr>
  </thead>
  <tbody>
    <% alerts.forEach(alert => { %>
    <tr>
      <td><%= alert.timestamp %></td>
      <td><%= alert.severity %></td>
      <td><%= alert.source_ip %></td>
      <td><%= alert.destination_ip %></td>
      <td><%= alert.protocol %></td>
      <td><%= alert.message %></td>
      <td><%= alert.status %></td>
      <td>
        <form method="post" action="/alerts/<%= alert.id %>/status">
          <% if (alert.status === 'new') { %>
          <input type="hidden" name="status" value="escalated">
          <button type="submit">Escalate</button>
          <% } else if (alert.status === 'escalated') { %>
          <input type="hidden" name="status" value="new">
          <button type="submit">Acknowledge</button>
          <% } %>
        </form>
      </td>
    </tr>
    <% }) %>
  </tbody>
</table>

<div class="pagination">
  <% if (page > 1) { %>
  <a href="?<%= new URLSearchParams({ ...query, page: page - 1 }).toString() %>">Previous</a>
  <% } %>
  <span>Page <%= page %> of <%= totalPages %></span>
  <% if (page < totalPages) { %>
  <a href="?<%= new URLSearchParams({ ...query, page: page + 1 }).toString() %>">Next</a>
  <% } %>
</div>
